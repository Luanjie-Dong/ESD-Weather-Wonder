_format_version: "3.0"

services:
  #######################################
  # USER SERVICE
  #######################################
  - name: user-api
    url: http://user:5000
    routes:
        - paths:
          - /api/v1/users/*
          strip_path: true
    plugins:
      - name: key-auth
  
  #######################################
  # LOCATION WEATHER SERVICE
  #######################################
  - name: location-weather-api
    url: http://location_weather:5003
    routes:
        - paths:
          - /api/v1/location-weather/*
          strip_path: true
    plugins:
      - name: key-auth

  #######################################
  # ADD A LOCATION
  #######################################
  - name: add-location-api
    url: http://add-a-location:5005
    routes:
        - paths:
          - /api/v1/location-weather/*
          strip_path: true
    plugins:
      - name: key-auth

  #######################################
  # EXTRACT USER LOCATION
  #######################################
  - name: user-location-api
    url: http://user-location:5005
    routes:
        - paths:
          - /api/v1/user-location/*
          strip_path: true
    plugins:
      - name: key-auth
        

#######################################
# AUTHENTICATION KEY
#######################################
consumers:
  - username: weatherwonder_app
    keyauth_credentials:
      - key: abc123xyz

#######################################
# RATE LIMITING
#######################################
plugins:
  - name: rate-limiting
    config:
      minute: 100
      policy: "local"
      limit_by: "ip"